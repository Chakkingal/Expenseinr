<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Personal Finance Dashboard</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />

    <!-- CSS -->
    <link rel="stylesheet" href="style.css">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- PapaParse -->
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
</head>

<body>

    <div class="container py-4">

        <!-- HEADER -->
        <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center gap-3 mb-3">
            <div>
                <div class="page-title">üí∞ Personal Finance Dashboard</div>
                <div class="small-muted" id="dashboardSubTitle">Ready</div>
            </div>

            <div class="d-flex gap-2 flex-wrap align-items-center">
                <select id="accountSelector" class="form-select" style="min-width:180px;">
                    <option value="INDIA">India (‚Çπ INR)</option>
                    <option value="UAE">UAE (AED)</option>
                </select>

                <button class="btn btn-dark" id="refreshBtn">
                    <span id="refreshSpinner" class="btn-spinner d-none"></span>
                    üîÑ Refresh
                </button>
            </div>
        </div>

        <!-- FILTER BAR -->
        <div class="filter-box mb-4">
            <div class="row g-2">
                <div class="col-12 col-md-3">
                    <select id="monthFilter" class="form-select">
                        <option value="ALL">All Months</option>
                    </select>
                </div>

                <div class="col-12 col-md-3">
                    <select id="modeFilter" class="form-select">
                        <option value="ALL">All Modes</option>
                    </select>
                </div>

                <div class="col-12 col-md-3">
                    <select id="groupFilter" class="form-select">
                        <option value="ALL">All Groups</option>
                    </select>
                </div>

                <div class="col-12 col-md-3">
                    <input id="searchBox" type="text" class="form-control"
                        placeholder="Search (item/from/narration...)" />
                </div>
            </div>
        </div>

        <!-- SUMMARY CARDS -->
        <div class="row g-3 mb-4">
            <div class="col-6 col-md-3">
                <div class="card p-3">
                    <div class="summary-title">Total Expense (Net)</div>
                    <div class="summary-value" id="totalExpense">--</div>
                </div>
            </div>

            <div class="col-6 col-md-3">
                <div class="card p-3">
                    <div class="summary-title">Total Receipts</div>
                    <div class="summary-value" id="totalReceipts">--</div>
                </div>
            </div>

            <div class="col-6 col-md-3">
                <div class="card p-3">
                    <div class="summary-title">Net Cash Flow</div>
                    <div class="summary-value" id="netCashflow">--</div>
                </div>
            </div>

            <div class="col-6 col-md-3">
                <div class="card p-3">
                    <div class="summary-title">Total Contra</div>
                    <div class="summary-value" id="totalContra">--</div>
                </div>
            </div>
        </div>

        <!-- MODE BALANCES -->
        <div class="mb-3">
            <div class="section-title">üè¶ Balance by Mode</div>
            <div class="small-muted">OB + Receipts - Expenses + Contra Transfers</div>
        </div>

        <div class="row g-3 mb-4" id="balanceCards">
            <div class="col-12">
                <div class="card p-3">
                    <div class="loading text-center">Loading...</div>
                </div>
            </div>
        </div>

        <!-- CHARTS -->
        <div class="row g-3 mb-4">
            <div class="col-12 col-md-6">
                <div class="card p-3">
                    <h6 class="fw-bold">üìà Expense Trend</h6>
                    <canvas id="expenseTrendChart"></canvas>
                </div>
            </div>

            <div class="col-12 col-md-6">
                <div class="card p-3">
                    <h6 class="fw-bold">üè¶ Expense by Mode</h6>
                    <canvas id="expenseModeChart"></canvas>
                </div>
            </div>
        </div>

        <div class="row g-3 mb-4">
            <div class="col-12 col-md-6">
                <div class="card p-3">
                    <h6 class="fw-bold">üßæ Expense by Group</h6>
                    <canvas id="expenseGroupChart"></canvas>
                </div>
            </div>

            <div class="col-12 col-md-6">
                <div class="card p-3">
                    <h6 class="fw-bold">üìä Receipts vs Expense</h6>
                    <canvas id="receiptVsExpenseChart"></canvas>
                </div>
            </div>
        </div>

        <!-- TABLES -->
        <div class="row g-3">

            <!-- EXPENSE TABLE -->
            <div class="col-12">
                <div class="card p-3">
                    <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
                        <h6 class="fw-bold mb-0">üìù Expense Table</h6>

                        <select id="expenseSort" class="form-select form-select-sm">
                            <option value="date_desc">Sort: Date ‚Üì</option>
                            <option value="date_asc">Sort: Date ‚Üë</option>
                            <option value="amount_desc">Sort: Amount ‚Üì</option>
                            <option value="amount_asc">Sort: Amount ‚Üë</option>
                        </select>
                    </div>

                    <div class="table-responsive mt-2">
                        <table class="table table-sm table-bordered">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Month</th>
                                    <th>Item</th>
                                    <th>SubGroup</th>
                                    <th>Group</th>
                                    <th>Mode</th>
                                    <th class="text-end">Amount</th>
                                    <th>Narration</th>
                                </tr>
                            </thead>
                            <tbody id="expenseTable"></tbody>
                        </table>
                    </div>

                    <div class="d-flex justify-content-between align-items-center mt-2 flex-wrap gap-2">
                        <button class="btn btn-outline-dark btn-sm pagination-btn" onclick="prevPage('expense')">‚¨Ö
                            Prev</button>
                        <div class="small-muted" id="expensePageInfo">Page 1</div>
                        <button class="btn btn-outline-dark btn-sm pagination-btn" onclick="nextPage('expense')">Next
                            ‚û°</button>
                    </div>
                </div>
            </div>

            <!-- RECEIPTS TABLE -->
            <div class="col-12 col-md-6">
                <div class="card p-3">
                    <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
                        <h6 class="fw-bold mb-0">üíµ Receipts Table</h6>

                        <select id="receiptSort" class="form-select form-select-sm">
                            <option value="date_desc">Sort: Date ‚Üì</option>
                            <option value="date_asc">Sort: Date ‚Üë</option>
                            <option value="amount_desc">Sort: Amount ‚Üì</option>
                            <option value="amount_asc">Sort: Amount ‚Üë</option>
                        </select>
                    </div>

                    <div class="table-responsive mt-2">
                        <table class="table table-sm table-bordered">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Month</th>
                                    <th>From</th>
                                    <th>Mode</th>
                                    <th class="text-end">Amount</th>
                                </tr>
                            </thead>
                            <tbody id="receiptTable"></tbody>
                        </table>
                    </div>

                    <div class="d-flex justify-content-between align-items-center mt-2 flex-wrap gap-2">
                        <button class="btn btn-outline-dark btn-sm pagination-btn" onclick="prevPage('receipt')">‚¨Ö
                            Prev</button>
                        <div class="small-muted" id="receiptPageInfo">Page 1</div>
                        <button class="btn btn-outline-dark btn-sm pagination-btn" onclick="nextPage('receipt')">Next
                            ‚û°</button>
                    </div>
                </div>
            </div>

            <!-- CONTRA TABLE -->
            <div class="col-12 col-md-6">
                <div class="card p-3">
                    <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
                        <h6 class="fw-bold mb-0">üîÅ Contra Table</h6>

                        <select id="contraSort" class="form-select form-select-sm">
                            <option value="date_desc">Sort: Date ‚Üì</option>
                            <option value="date_asc">Sort: Date ‚Üë</option>
                            <option value="amount_desc">Sort: Amount ‚Üì</option>
                            <option value="amount_asc">Sort: Amount ‚Üë</option>
                        </select>
                    </div>

                    <div class="table-responsive mt-2">
                        <table class="table table-sm table-bordered">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Month</th>
                                    <th>From</th>
                                    <th>To</th>
                                    <th class="text-end">Amount</th>
                                </tr>
                            </thead>
                            <tbody id="contraTable"></tbody>
                        </table>
                    </div>

                    <div class="d-flex justify-content-between align-items-center mt-2 flex-wrap gap-2">
                        <button class="btn btn-outline-dark btn-sm pagination-btn" onclick="prevPage('contra')">‚¨Ö
                            Prev</button>
                        <div class="small-muted" id="contraPageInfo">Page 1</div>
                        <button class="btn btn-outline-dark btn-sm pagination-btn" onclick="nextPage('contra')">Next
                            ‚û°</button>
                    </div>
                </div>
            </div>

        </div>

    </div>

    <script src="app.min.js"></script>
</body>

</html>
